#!/bin/sh

set -e

if fc-list | grep Meslo > /dev/null 2>&1; then
  echo "Meslo font exists. Skipping installation of Meslo font..."
else
  echo "Meslo font not found. Installing Meslo font..."
  git clone https://github.com/powerline/fonts.git ~/fonts --depth=1 && \
    ~/fonts/install.sh
  rm -rf ~/fonts
fi

if infocmp alacritty > /dev/null 2>&1; then
  echo "alacritty terminfo found. Skipping installation of alacritty terminfo..."
else
  echo "alacritty terminfo not found. Installing alacritty terminfo..."
  curl https://raw.githubusercontent.com/alacritty/alacritty/master/extra/alacritty.info > ~/alacritty.info
  sudo tic -xe alacritty,alacritty-direct ~/alacritty.info
  rm ~/alacritty.info
fi

echo "symlinking alacritty"
ln -nsf ~/dotfiles/alacritty ~/.config/alacritty

if command -v nvim > /dev/null 2>&1; then
  echo "neovim found. Skipping installation of neovim..."
else
  echo "neovim not found. Installing neovim..."

  if [ "$(uname)" = "Darwin" ]; then
    brew install neovim
  else
    echo "Install neovim on your own!"
    exit 1
  fi
fi

echo "symlinking nvim"
ln -nsf ~/dotfiles/nvim ~/.config

if [ ! -f ~/dotfiles/nvim/autoload/plug.vim ]; then
  echo "Installing vim-plug"
  curl -fLo ~/dotfiles/nvim/autoload/plug.vim --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
else
  echo "vim-plug found. Skipping installation of vim-plug..."
fi

echo "Install vim-plug plugins"
nvim --headless +PlugInstall +qall

echo "symlinking coc"
ln -nsf ~/dotfiles/coc ~/.config

echo "symlinking tmux"
ln -nsf ~/dotfiles/.tmux.conf ~/

if [ ! -d ~/.tmux/plugins/tpm ]; then
  echo "tpm not found. Installing tpm..."
  git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && \
    ~/.tmux/plugins/tpm/bin/install_plugins
else
  echo "tpm found. Skipping installation of tpm..."
fi
